import{_ as U,u as $,r as u,c as i,o as H,a as D,b as v,d as a,e as _,w as k,v as x,n as w,t as p,f as E,g as L,h as S,i as j,j as P,k as W,R as q,l as F,m as c,E as V}from"./index-BLFan52e.js";const G={class:"reg-box"},J={class:"textbox"},K={class:"textbox"},O={key:0,class:"password-strength"},Q={class:"strength-bar"},X={class:"verify"},Y={class:"captcha-container"},ee=["src"],te={key:1,class:"loading"},se={key:2,class:"cooldown"},ae={key:1,class:"error-message"},le=["disabled"],re={class:"login-link"},ne={__name:"RegisterView",setup(ue){const A=F(),I=$(),l=u(""),z=function(){return!(l.value.length<4||l.value.length>20||!/^[a-zA-Z0-9_]+$/.test(l.value))},R=i(()=>l.value.length===0?"":l.value.length<4||l.value.length>20?"用户名长度应在4-20之间":/^[a-zA-Z0-9_]+$/.test(l.value)?"√":"用户名只能包含字母、数字和下划线"),Z=i(()=>z()?"valid":"wrong"),t=u(""),y=function(){return!(t.value.length<6||t.value.length>20||!/^[a-zA-Z0-9_]+$/.test(t.value)||!/[a-zA-Z]/.test(t.value)||!/[0-9]/.test(t.value))},B=i(()=>t.value.length===0?"":t.value.length<6||t.value.length>20?"密码长度应在6-20之间":/^[a-zA-Z0-9_]+$/.test(t.value)?!/[a-zA-Z]/.test(t.value)||!/[0-9]/.test(t.value)?"密码必须包含字母和数字":t.value.length<10?"密码强度：弱":t.value.length<15?"密码强度：中":"密码强度：强":"密码只能包含字母、数字和下划线"),M=i(()=>y()?"valid":"wrong"),C=i(()=>t.value.length===0||!y()?"":t.value.length<10?"weak":t.value.length<15?"medium":"strong"),N=i(()=>{const e=C.value;return e==="weak"?"33%":e==="medium"?"66%":e==="strong"?"100%":"0%"}),g=u(""),b=u(""),m=u(!1),n=u(0),o=u(null),r=u(""),h=async()=>{if(!(n.value>0)){m.value=!0,r.value="";try{const e=Date.now();b.value=`/api/captcha?t=${e}`,n.value=3,o.value&&clearInterval(o.value),o.value=setInterval(()=>{n.value--,n.value<=0&&(clearInterval(o.value),o.value=null)},1e3),await new Promise(s=>setTimeout(s,500))}catch(e){console.error("获取验证码失败:",e),e.response&&e.response.status===429?r.value="请求过于频繁，请等待几分钟后再试":r.value="获取验证码失败，请稍后再试"}finally{m.value=!1}}},d=u(!1),T=async()=>{if(!d.value){if(!z()||!y()){r.value="用户名和密码格式不正确！";return}if(!g.value){r.value="请输入验证码！";return}d.value=!0,r.value="";try{const e=await I.register(l.value,t.value,g.value);e.success?(V({title:"成功",message:"用户注册成功！即将跳转到登录页面",type:"success",duration:3e3,position:"top-right"}),setTimeout(()=>{A.push("/")},2e3)):(console.log("注册失败:",e.message),V({title:"注册失败",message:e.message||"未知错误",type:"error",duration:4e3,position:"top-right"}),r.value=e.message||"未知错误",(!e.message||e.message.includes("验证码")||e.message.includes("captcha")||e.message.includes("验证"))&&(n.value=0,h()))}catch(e){console.error("注册过程中发生异常:",e);let s="网络繁忙，请稍后再试！";e.response&&(e.response.status===429?s="请求过于频繁，请等待几分钟后再试！":e.response.data&&e.response.data.message&&(s=e.response.data.message)),V({title:"注册失败",message:s,type:"error",duration:4e3,position:"top-right"}),r.value=s,e.response&&e.response.status!==429&&(n.value=0,h())}finally{console.log("注册流程结束"),d.value=!1}}};return H(()=>{h()}),D(()=>{o.value&&clearInterval(o.value)}),(e,s)=>(c(),v("div",G,[s[5]||(s[5]=a("h1",null,"注册",-1)),a("form",{onSubmit:L(T,["prevent"])},[a("div",J,[k(a("input",{type:"text",placeholder:"用户名","onUpdate:modelValue":s[0]||(s[0]=f=>l.value=f)},null,512),[[x,l.value]])]),a("div",{class:w(Z.value)},p(R.value),3),a("div",K,[k(a("input",{type:"password",placeholder:"密码","onUpdate:modelValue":s[1]||(s[1]=f=>t.value=f)},null,512),[[x,t.value]])]),t.value?(c(),v("div",O,[a("div",Q,[a("div",{class:w(["strength-bar-fill",C.value]),style:E({width:N.value})},null,6)])])):_("",!0),a("div",{class:w(M.value)},p(B.value),3),a("div",X,[k(a("input",{type:"text",placeholder:"验证码","onUpdate:modelValue":s[2]||(s[2]=f=>g.value=f)},null,512),[[x,g.value]]),a("div",Y,[!m.value&&b.value?(c(),v("img",{key:0,class:w(["captcha",{disabled:n.value>0}]),src:b.value,onClick:h,alt:"验证码"},null,10,ee)):m.value?(c(),v("div",te,"加载中...")):_("",!0),n.value>0?(c(),v("div",se,p(n.value)+"s",1)):_("",!0)])]),r.value?(c(),v("div",ae,p(r.value),1)):_("",!0),a("button",{type:"submit",class:"btn",disabled:d.value},p(d.value?"注册中...":"注册"),9,le)],32),a("div",re,[s[4]||(s[4]=S(" 已有账号？")),j(W(q),{to:"/"},{default:P(()=>s[3]||(s[3]=[S("登录")])),_:1})])]))}},ie=U(ne,[["__scopeId","data-v-6986919d"]]);export{ie as default};
